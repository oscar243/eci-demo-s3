<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Architecture Animation</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            padding: 10px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .controls {
            background: #f1f5f9;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .controls-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 80px;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-next { background: #3b82f6; color: white; }
        
        .frame-info {
            font-size: 14px;
            color: #475569;
            font-weight: 500;
        }
        
        #diagram {
            min-height: 500px;
            padding: 40px 20px;
            background: white;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #diagram .mermaid {
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
        }
        
        #diagram.loaded {
            opacity: 1;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            color: #64748b;
            font-size: 16px;
        }
        
        .loading.hidden {
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .controls-row {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn {
                min-width: 120px;
            }
            
            #diagram {
                padding: 20px 10px;
                min-height: 400px;
            }
            
            .container {
                max-width: 100%;
                margin: 0 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="controls-row">
                <button id="prevBtn" class="btn btn-next">⏮ Previous</button>
                <button id="nextBtn" class="btn btn-next">⏭ Next</button>
            </div>
            
            <div class="controls-row">
                <div class="frame-info">
                    <span id="currentFrame">1</span>/<span id="totalFrames">-</span> - <span id="frameDescription">Loading...</span>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading">
            <div>Cargando animación...</div>
        </div>
        
        <div id="diagram" class="mermaid"></div>
    </div>

    <script>
        class SimpleAnimator {
            constructor() {
                this.currentFrame = 0;
                
                // Cargar frames y inicializar
                this.loadFramesFromFile().then(() => {
                    this.init();
                    this.render();
                });
            }
            
            // Cargar frames desde archivo JSON
            async loadFramesFromFile() {
                try {
                    // Agregar timestamp para evitar caché
                    const timestamp = new Date().getTime();
                    const response = await fetch(`animation-frames.json?t=${timestamp}`);
                    const data = await response.json();
                    this.frames = data.frames;
                } catch (error) {
                    console.error('Could not load animation-frames.json:', error);
                    this.frames = [];
                }
            }
            
            // Configurar controles y eventos
            init() {
                document.getElementById('prevBtn').onclick = () => this.previous();
                document.getElementById('nextBtn').onclick = () => this.next();
                
                document.getElementById('totalFrames').textContent = this.frames.length;
            }
            
            // Generar código Mermaid para un frame específico
            generateDiagram(frameIndex) {
                const frame = this.frames[frameIndex];
                const connections = frame.connections.join('\n                ');
                
                return `graph LR
                subgraph " "
                    USER["<img src='images/user.svg' width='40' height='40'/><br/>User"]
                end
                
                subgraph "  "
                    API["<img src='images/api-g.svg' width='40' height='40'/><br/>API"]
                    LUP["<img src='images/lambda.svg' width='40' height='40'/><br/>Upload"]
                    LDN["<img src='images/lambda.svg' width='40' height='40'/><br/>Status"]
                end
                
                subgraph "   "
                    S3["<img src='images/s3.svg' width='40' height='40'/><br/>S3"]
                    L["<img src='images/lambda1.svg' width='40' height='40'/><br/>Process"]
                end
                
                subgraph "    "
                    IT["<img src='images/internet-ext.svg' width='40' height='40'/><br/>AssemblyAI"]
                    IP["<img src='images/internet-ext.svg' width='40' height='40'/><br/>Claude"]
                end
                
                ${connections}`;
            }
            
            // Renderizar frame actual
            render() {
                const diagramCode = this.generateDiagram(this.currentFrame);
                const diagramDiv = document.getElementById('diagram');
                const loadingDiv = document.getElementById('loading');
                
                // Mostrar loading y ocultar diagrama
                loadingDiv.classList.remove('hidden');
                diagramDiv.classList.remove('loaded');
                
                // Crear nuevo contenedor para el diagrama
                const mermaidDiv = document.createElement('div');
                mermaidDiv.className = 'mermaid';
                mermaidDiv.style.visibility = 'hidden';
                mermaidDiv.textContent = diagramCode;
                diagramDiv.innerHTML = '';
                diagramDiv.appendChild(mermaidDiv);
                
                // Renderizar y mostrar cuando esté listo
                setTimeout(() => {
                    mermaid.init(undefined, mermaidDiv);
                    setTimeout(() => {
                        mermaidDiv.style.visibility = 'visible';
                        diagramDiv.classList.add('loaded');
                        loadingDiv.classList.add('hidden');
                    }, 100);
                }, 50);
                
                // Actualizar información del frame
                document.getElementById('currentFrame').textContent = this.currentFrame + 1;
                document.getElementById('frameDescription').textContent = this.frames[this.currentFrame].description;
            }
            
            // Controles de navegación
            previous() {
                this.currentFrame = (this.currentFrame - 1 + this.frames.length) % this.frames.length;
                this.render();
            }
            
            next() {
                this.currentFrame = (this.currentFrame + 1) % this.frames.length;
                this.render();
            }
        }
        
        // Configuración de Mermaid
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose'
        });
        
        // Inicializar cuando cargue la página
        document.addEventListener('DOMContentLoaded', () => {
            new SimpleAnimator();
        });
    </script>
</body>
</html>
